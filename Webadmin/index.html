<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>BadgeAdmin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body><script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <script>

        // Globally initializes an mqtt variable
        const clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8)
currentNumber = 0
const host = 'ws://localhost:8080/'

const options = {
    userName:'ztl',
    password: 'Ztl2019!',
  keepalive: 60,
  clientId: clientId,
  protocolId: 'MQTT',
  protocolVersion: 5,
  clean: true,
  reconnectPeriod: 1000,
  connectTimeout: 30 * 1000,
  will: {
    topic: 'macherdaach/queue/messageFromPlace',
    payload: 'Connection Closed abnormally..!',
    qos: 0,
    retain: false
  },
}

console.log('Connecting mqtt client')
const client = mqtt.connect(host, options)

client.on('error', (err) => {
  console.log('Connection error: ', err)
  client.end()
})

client.on('reconnect', () => {
  console.log('Reconnecting...')
})
client.on('connect', () => {
  console.log('Client connected:' + clientId)
  // Subscribe
  client.subscribe('macherdaach/queue/messageFromPlace', { qos: 0 })
})
client.on('message', (topic, message, packet) => {
  console.log('Received Message: ' + message.toString() + '\nOn topic: ' + topic)
})

function nextUser(){
  
override = $('#nextnum').val();
if (override != currentNumber){
  client.publish('macherdaach/queue/messageFromPlace', 
{
  "new_number":override
}, { qos: 0, retain: false });
}else{
client.publish('macherdaach/queue/messageFromPlace', 
{
  "new_number":currentNumber
}, { qos: 0, retain: false });
currentNumber++;
}
$('#nextnum').val(currentNumber);
console.log('NEXT')
}

  console.log('ready');
  

    </script>
    <h1>BADEADMIN:</h1>
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Neue Nummer</button>
        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-seats" aria-selected="false">Sitzpl√§tze</button>
        <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-debug" aria-selected="false">DEBUG</button>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
        <div class="col-lg-6">
        <div class="input-group mb-3">
          <input id="nextnum" type="number" class="form-control" placeholder="NEW Queue Member" aria-label="NEW Queue Member" aria-describedby="basic-addon2">
          <button onclick="nextUser();" id="next" class="input-group-text" id="basic-addon2">NEXT</button>
        </div>
      </div>
      </div>
      
      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-seats-tab">
        
      </div>
      
      
      
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-debug-tab"></div>
      <div id="logger"></div></div>
    
</body>
</html>